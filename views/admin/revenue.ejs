<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Revenue Dashboard | Admin</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body { background:#f2e5e2; font-family: Inter, sans-serif; }
    .content { margin-left:250px; padding:40px; }
    .card-box {
      background:#fff;
      border-radius:18px;
      padding:25px;
      box-shadow:0 4px 15px rgba(0,0,0,.08);
    }
    .stat-value { font-size:26px; font-weight:700; }
  </style>
</head>

<body>

<%- include('./adminPartials/adminSidebar') %>

<div class="content">

  <!-- HEADER -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold">Revenue Dashboard</h2>

    <form method="GET">
      <input type="hidden" name="download" value="excel">
      <button class="btn btn-outline-success">Export Excel</button>
    </form>
  </div>

  <!-- DATE FILTER -->
  <form class="row g-3 mb-4">
    <div class="col-md-3">
      <input type="date" name="from" class="form-control" value="<%= from || '' %>">
    </div>
    <div class="col-md-3">
      <input type="date" name="to" class="form-control" value="<%= to || '' %>">
    </div>
    <div class="col-md-2">
      <button class="btn btn-primary w-100">Apply</button>
    </div>
  </form>

  <!-- METRICS -->
  <div class="row g-4 mb-4">
    <div class="col-md-3">
      <div class="card-box">
        <div>Total Revenue</div>
        <div class="stat-value">₹ <%= metrics.totalRevenue %></div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card-box">
        <div>Discounts</div>
        <div class="stat-value text-danger">₹ <%= metrics.totalDiscount %></div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card-box">
        <div>Net Revenue</div>
        <div class="stat-value text-success">₹ <%= metrics.netRevenue %></div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card-box">
        <div>Total Orders</div>
        <div class="stat-value"><%= metrics.totalOrders %></div>
      </div>
    </div>
  </div>

  <!-- CHARTS -->
  <div class="row g-4">
    <div class="col-md-8">
      <div class="card-box">
        <h6>Revenue Trend</h6>
        <canvas id="revenueChart"></canvas>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card-box">
        <h6>Payment Distribution (%)</h6>
        <canvas id="paymentChart"></canvas>
      </div>
    </div>
  </div>

</div>

<script>
  const revenueData = <%- JSON.stringify(dailyRevenue) %>;

  new Chart(document.getElementById('revenueChart'), {
    type: 'line',
    data: {
      labels: Object.keys(revenueData),
      datasets: [{
        label: 'Revenue',
        data: Object.values(revenueData),
        tension: 0.4
      }]
    },
    options: {
      plugins: { legend: { display: false } }
    }
  });

  new Chart(document.getElementById('paymentChart'), {
    type: 'doughnut',
    data: {
      labels: ['Paid %', 'Pending %', 'Refunded %', 'Cancelled %'],
      datasets: [{
        data: [
          <%= paymentStats.paid %>,
          <%= paymentStats.pending %>,
          <%= paymentStats.refunded %>,
          <%= paymentStats.cancelled %>
        ]
      }]
    },
    options: {
      plugins: {
        tooltip: {
          callbacks: {
            label: ctx => `${ctx.label}: ${ctx.raw}%`
          }
        }
      }
    }
  });
</script>

</body>
</html>
