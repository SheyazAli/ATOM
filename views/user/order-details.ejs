<!DOCTYPE html> 
<html lang="en"> 
  <head> 
    <meta charset="UTF-8">
    <title>Order Details | ATOM</title> 
    <meta name="viewport" content="width=device-width, initial-scale=1"> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"> 
    <style> body { font-family: "Segoe UI", sans-serif; background: #fff; color: #111; } 
    .account-wrapper { padding: 60px 0 80px; } 
    .page-title { font-size: 26px; font-weight: 600; margin-bottom: 24px; } 
    .card-box { background: #f9fafb; border-radius: 16px; padding: 22px; margin-bottom: 24px; } 
    .product-img { width: 72px; height: 92px; object-fit: cover; border-radius: 12px; border: 1px solid #ddd; } 
    .badge-status { font-size: 12px; padding: 4px 10px; border-radius: 14px; font-weight: 500; display: inline-block; } 
    .badge-green { background:#dcfce7; color:#166534; } 
    .badge-red { background:#fee2e2; color:#991b1b; } 
    .badge-yellow { background:#fff7ed; color:#9a3412; } 
    </style> 
    </head> 
    <body> 
      <%- include('./userPartials/navbar') %> 
      <div class="container account-wrapper"> 
        <div class="row"> 
          <%- include('./userPartials/sidebar') %>
           <div class="col-lg-9"> 
            <div class="page-title"> Order #<%= order.orderNumber %> 
            </div> 
            <!-- ORDER META --> 
             <div class="card-box d-flex gap-5"> 
              <div> <small class="text-muted">Order Date</small> 
                <div class="fw-semibold"> 
                  <%= new Date(order.created_at).toDateString() %> 
                </div> 
              </div> 
              <div> 
                <small class="text-muted">Payment</small> 
                <div class="fw-semibold text-uppercase"> <%= order.paymentMethod %> 
                </div> 
              </div> 
              <div> 
                <small class="text-muted">Status</small> 
                <div class="fw-semibold text-capitalize"> 
                  <%= order.status.replace('_', ' ') %> 
                </div> 
              </div> 
            </div> 
            <!-- ITEMS --> 
             <% items.forEach(item => { %> 
              <div class="card-box"> 
                <div class="d-flex gap-4"> 
                  <img src="/uploads/<%= item.image %>" class="product-img"> 
                  <div class="flex-grow-1"> 
                    <div class="fw-semibold"><%= item.name %></div> 
                    <div class="text-muted small mt-1"> 
                      Size: <%= item.size %> | Ordered: <%= item.orderedQty %> | Price: ₹<%= item.price %>
                     </div>
                       <!-- CANCEL INFO --> 
                        <% if (item.cancelledQty > 0) { %> 
                          <div class="mt-2 badge-status badge-red"> 
                            Cancelled Qty: <%= item.cancelledQty %> 
                          </div> <% } %> 
                          <!-- RETURN INFO (FIXED LOGIC) -->
                            <% if (item.returnStatus === 'approved') { %> 
                              <div class="mt-2 badge-status badge-yellow"> Returned Qty: <%= item.returnedQty %> </div> 
                              <% } else if (item.returnStatus === 'pending') { %> 
                                <div class="mt-2 badge-status badge-yellow"> Return request pending 

                                </div> <% } else if (item.returnStatus === 'rejected') { %> 
                                  div class="mt-2 badge-status badge-red"> Return request rejected 
                                </div> <% } %> 
                                <!-- ADMIN MESSAGE (ONLY WHEN REJECTED) --> 
                                 <% if (item.returnStatus === 'rejected' && item.message) { %> 
                                  <div class="alert alert-light mt-3 p-2"> 
                                    <strong>Reason:</strong> <%= item.message %> </div> <% } %> 
                                  </div> <div class="fw-semibold"> ₹<%= item.price * item.orderedQty %>
                                  </div> 
                                </div> 
                              </div> <% }) %> 
                              <!-- SHIPPING --> 
                               <div class="card-box"> 
                                <h6 class="mb-2">Shipping Address</h6>
                                 <p class="mb-1 fw-semibold"><%= order.address.building_name %></p>
                                  <p class="mb-1"><%= order.address.address_line_1 %></p> 
                                  <p class="mb-1"> <%= order.address.city %><%= order.address.state %> - <%= order.address.postal_code %> </p>
                                  <p class="mb-0">Phone: <%= order.address.phone_number %></p> 
                                </div>
                                 <!-- PRICE -->
                                   <div class="card-box"> 
                                    <h6 class="mb-2">Price Breakdown</h6> 
                                    <div class="d-flex justify-content-between"> <span>Item Total</span> 
                                      <span>₹<%= price.itemTotal %></span> 
                                    </div> 
                                    <div class="d-flex justify-content-between"> <span>Shipping</span> 
                                      <span><%= price.shipping === 0 ? 'Free' : '₹' + price.shipping %></span> 
                                    </div> 
                                    <hr> 
                                    <div class="d-flex justify-content-between fw-semibold"> 
                                      <span>Total</span> 
                                      <span>₹<%= price.finalAmount %></span> 
                                    </div> 
                                  </div> 
                                </div> 
                              </div> 
                            </div> 
                            <%- include('./userPartials/footer') %> 
                          </body> 
                          </html>