<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reset Password | ATOM</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
    }

    .reset-wrapper {
      min-height: 100vh;
      background: url("/uploads/SALE.jpg") center / cover no-repeat;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .reset-wrapper::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
    }

    .reset-card {
      position: relative;
      z-index: 2;
      background: #fff;
      width: 100%;
      max-width: 380px;
      padding: 32px 26px;
      border-radius: 14px;
      box-shadow: 0 15px 50px rgba(0,0,0,0.35);
      text-align: center;
    }

    .reset-card img {
      width: 42px;
      margin-bottom: 10px;
    }

    .reset-card h4 {
      font-weight: 600;
      margin-bottom: 6px;
    }

    .reset-desc {
      font-size: 13px;
      color: #666;
      margin-bottom: 16px;
    }

    .otp-inputs {
      display: flex;
      justify-content: space-between;
      margin: 18px 0 22px;
    }

    .otp-inputs input {
      width: 46px;
      height: 50px;
      text-align: center;
      font-size: 18px;
      border-radius: 10px;
      border: 1px solid #ddd;
      background: #fff5f5;
    }

    .otp-inputs input:focus {
      outline: none;
      border-color: #008060;
    }

    .form-label {
      font-size: 13px;
      font-weight: 500;
    }

    .form-control {
      height: 42px;
      font-size: 13px;
      border-radius: 6px;
    }

    /* ✅ GREEN RESET BUTTON */
    .btn-reset {
      background: #008060;
      color: #fff;
      border: none;
      height: 44px;
      font-weight: 500;
      border-radius: 8px;
      margin-top: 8px;
    }

    .btn-reset:hover {
      background: #006e52;
    }

    /* ✅ GREY RESEND BUTTON */
    .btn-resend {
      background: #f1f1f1;
      color: #444;
      border: none;
      height: 40px;
      border-radius: 8px;
      font-size: 13px;
      margin-top: 12px;
    }

    .btn-resend:hover {
      background: #e2e2e2;
    }
  </style>
</head>

<body>

<section class="reset-wrapper">
  <div class="reset-card">

    <img src="/uploads/Atom logo white bg.png" alt="ATOM">

    <h4>Reset Password</h4>
    <div class="reset-desc">
      Enter the OTP sent to your email and set a new password
    </div>

    <% if (error) { %>
      <div class="alert alert-danger py-2 text-center">
        <%= error %>
      </div>
    <% } %>

    <form action="/user/reset-password?_method=PUT" method="POST">

      <input type="hidden" name="otp" id="otpHidden">
        <!-- OTP -->
      <div class="otp-inputs">
        <input type="text" maxlength="1" class="otp-digit">
        <input type="text" maxlength="1" class="otp-digit">
        <input type="text" maxlength="1" class="otp-digit">
        <input type="text" maxlength="1" class="otp-digit">
        <input type="text" maxlength="1" class="otp-digit">
        <input type="text" maxlength="1" class="otp-digit">
      </div>
        <!-- PASSWORD -->
      <div class="mb-3 text-start">
        <label class="form-label">New Password</label>
        <input type="password" name="newPassword" class="form-control" required>
      </div>

      <div class="mb-3 text-start">
        <label class="form-label">Confirm New Password</label>
        <input type="password" name="confirmPassword" class="form-control" required>
      </div>

      <button type="submit" class="btn btn-reset w-100">
        Reset Password
      </button>
    </form>

   <form action="/user/password/resend-otp" method="POST">
      <button
        type="submit"
        class="btn btn-secondary w-100"
        id="resendBtn"
        disabled
      >
        Resend OTP
      </button>

      <p class="mt-2 text-muted small text-center">
        <span id="timerText">Resend available in 01:30</span>
      </p>
    </form>


  </div>
</section>

<script>
  const inputs = document.querySelectorAll('.otp-digit');
  const hiddenInput = document.getElementById('otpHidden');

  inputs.forEach((input, index) => {
    input.addEventListener('input', () => {
      input.value = input.value.replace(/[^0-9]/g, '');
      if (input.value && index < inputs.length - 1) {
        inputs[index + 1].focus();
      }
      hiddenInput.value = Array.from(inputs).map(i => i.value).join('');
    });

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace' && !input.value && index > 0) {
        inputs[index - 1].focus();
      }
    });
  });
</script>
<script>
  const RESEND_DELAY = 90; // seconds
  const otpSentAt = <%= otpSentAt || Date.now() %>;

  const resendBtn = document.getElementById('resendBtn');
  const timerText = document.getElementById('timerText');

  function startTimer() {
    const elapsed = Math.floor((Date.now() - otpSentAt) / 1000);
    let remaining = RESEND_DELAY - elapsed;

    if (remaining <= 0) {
      resendBtn.disabled = false;
      timerText.textContent = 'You can resend OTP now';
      return;
    }

    const interval = setInterval(() => {
      remaining--;

      const min = String(Math.floor(remaining / 60)).padStart(2, '0');
      const sec = String(remaining % 60).padStart(2, '0');

      timerText.textContent = `Resend available in ${min}:${sec}`;

      if (remaining <= 0) {
        clearInterval(interval);
        resendBtn.disabled = false;
        timerText.textContent = 'You can resend OTP now';
      }
    }, 1000);
  }

  startTimer();
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
