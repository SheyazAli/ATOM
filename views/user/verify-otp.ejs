<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Verify OTP | ATOM</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
    }

    /* BACKGROUND */
    .otp-wrapper {
      min-height: 100vh;
      background: url("/uploads/SALE.jpg") center / cover no-repeat;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .otp-wrapper::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
    }

    /* CARD */
    .otp-card {
      position: relative;
      z-index: 2;
      background: #fff;
      width: 100%;
      max-width: 380px;
      padding: 28px 26px;
      border-radius: 14px;
      box-shadow: 0 15px 50px rgba(0,0,0,0.35);
      text-align: center;
    }

    .otp-card img {
      width: 42px;
      margin-bottom: 10px;
    }

    .otp-card h4 {
      font-weight: 600;
      margin-bottom: 6px;
    }

    .otp-card p {
      font-size: 13px;
      color: #666;
      margin-bottom: 20px;
    }

    /* OTP INPUTS */
    .otp-inputs {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 22px;
    }

    .otp-inputs input {
      width: 48px;
      height: 52px;
      border-radius: 10px;
      border: 1px solid #ddd;
      background: #fff5f5;
      text-align: center;
      font-size: 18px;
    }

    .otp-inputs input:focus {
      outline: none;
      border-color: #008060;
      box-shadow: none;
    }

    /* BUTTONS */
    .btn-submit {
      background: #008060;
      color: #fff;
      border: none;
      height: 44px;
      border-radius: 8px;
      font-weight: 500;
    }

    .btn-submit:hover {
      background: #006e52;
    }

    .btn-resend {
      background: #f2f2f2;
      border: none;
      color: #555;
      height: 40px;
      border-radius: 8px;
      font-size: 13px;
      margin-top: 12px;
    }

    .btn-resend:hover {
      background: #e6e6e6;
    }
  </style>
</head>

<body>

<section class="otp-wrapper">
  <div class="otp-card">

    <img src="/uploads/Atom logo white bg.png" alt="ATOM">

    <h4>Verify with OTP</h4>
    <p>We have sent a verification code to your email / phone number.</p>

    <% if (typeof error !== 'undefined') { %>
      <div class="alert alert-danger py-1"><%= error %></div>
    <% } %>

    <form action="/user/verify-otp" method="POST">

      <input type="hidden" name="otp" id="otpHidden">

      <div class="otp-inputs">
        <input type="text" maxlength="1" class="otp-digit" required>
        <input type="text" maxlength="1" class="otp-digit" required>
        <input type="text" maxlength="1" class="otp-digit" required>
        <input type="text" maxlength="1" class="otp-digit" required>
        <input type="text" maxlength="1" class="otp-digit" required>
        <input type="text" maxlength="1" class="otp-digit" required>
      </div>

      <button type="submit" class="btn btn-submit w-100">
        Submit OTP
      </button>
    </form>

    <form action="/user/signup/resend-otp" method="POST">
      <button
        type="submit"
        class="btn btn-resend w-100"
        id="resendBtn"
        disabled
      >
        Resend OTP
      </button>
      <p class="mt-2 text-muted" style="font-size: 13px;">
        <span id="timerText">Resend available in 30</span>
      </p>
    </form>

  </div>
</section>

<script>
  const inputs = document.querySelectorAll('.otp-digit');
  const hiddenInput = document.getElementById('otpHidden');

  inputs.forEach((input, index) => {
    input.addEventListener('input', () => {
      if (input.value && index < inputs.length - 1) {
        inputs[index + 1].focus();
      }
      hiddenInput.value = Array.from(inputs).map(i => i.value).join('');
    });

    input.addEventListener('keydown', e => {
      if (e.key === 'Backspace' && !input.value && index > 0) {
        inputs[index - 1].focus();
      }
    });
  });
</script>
<script>
  const RESEND_DELAY = 30; // seconds
  const otpSentAt = <%= otpSentAt || Date.now() %>;

  const resendBtn = document.getElementById('resendBtn');
  const timerText = document.getElementById('timerText');

  function startTimer() {
    const now = Date.now();
    const elapsed = Math.floor((now - otpSentAt) / 1000);
    let remaining = RESEND_DELAY - elapsed;

    if (remaining <= 0) {
      resendBtn.disabled = false;
      timerText.textContent = 'You can resend OTP now';
      return;
    }

    const interval = setInterval(() => {
      remaining--;

      const min = String(Math.floor(remaining / 60)).padStart(2, '0');
      const sec = String(remaining % 60).padStart(2, '0');

      timerText.textContent = `Resend available in ${min}:${sec}`;

      if (remaining <= 0) {
        clearInterval(interval);
        resendBtn.disabled = false;
        timerText.textContent = 'You can resend OTP now';
      }
    }, 1000);
  }

  startTimer();
</script>

</body>
</html>
